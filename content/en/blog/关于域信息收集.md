---
title: 关于域信息收集
encrypt: false
enc_pwd: askding
categories:
  - Tools
date: 2022-04-27 21:50:54
top:
tags:
layout:
---
编写进度
- [x] 


# Table of Contents

1.  [DC](#orgd21826a)
    1.  [net类命令](#org1625edc)
    2.  [查看当前用户权限及SID](#org6024d02)
    3.  [查看是否存在域](#org5c9d637)
        1.  [systeminfo判断](#org96be934)
        2.  [`net time /domain` 判断](#orgeb67873)
        3.  [`net config workstation` 判断](#org2070906)
2.  [探测存活主机](#org06320c0)
    1.  [利用ICMP协议探测](#orgcbed0df)


<a id="orgd21826a"></a>

# DC

dns一般为域控，并且域控会开启389端口（LDAP服务）


<a id="org1625edc"></a>

## net类命令

    net accounts                               # 查看本地密码策略
    net accounts /domain                       # 查看域密码策略
    
    net user                                   # 查看本机有哪些用户
    net user /domain                           # 查看当前域中所有域用户
    net user <account-name> /domain            # 查看域用户登陆时间，密码过期时间，是否有登陆脚本，所属组
    net time  /domain                          # 查看域时间
    
    net localgroup administrators              # 查看本机管理员账户
    net localgroup administrators /domain      # 查看登陆本机的域管理员账户
    
    net group /domain                          # 查看域内所有的组账户
    net group "domain admins"  /domain         # 查看域管理员用户组及成员
    net group "domain controllers"  /domain    # 查看域控列表
    nslookup -type=SRV _ldap._tcp.dc._msdcs.gpgc.local    # 定位域控主机名
    
    net group "domain computers" /domain       # 查看所有域成员计算机列表
    
    net view  /domain:gpgc.local               # 查看指定域列表
    nltest /domain_trusts                      # 获取域信任信息
    nltest /dclist:xxzx.gpgc.local             # 查看域控
    cmdkey /l			                         # 是否保存了登录凭证
    
    rout print                                 # 打印当前路由信息
    netstat -ant                               # 查看网络连接情况


<a id="org6024d02"></a>

## 查看当前用户权限及SID

    whoami /all
    
    用户信息
    ----------------
    
    用户名                SID                                           
    ===================== ==============================================
    ethanhunter78bc\ethan S-1-5-21-4157029122-2371177861-4132612220-1000


<a id="org5c9d637"></a>

## 查看是否存在域


<a id="org96be934"></a>

### systeminfo判断

systeminfo系统信息中含有两项：Domain和Logon Server，前者为域名，后者为域控。倘若Domain为Workgroup则当前服务器不在域内

    systeminfo | findstr "\."
    
    OS 版本:          10.0.19042 暂缺 Build 19042
    系统制造商:       Parallels Software International Inc.
    BIOS 版本:        Parallels Software International Inc. 16.1.2 (49151), 2020/12/18
    页面文件位置:     C:\pagefile.sys
    域：             xxzx.example.local                    ---> 当前所在域
                            DHCP 服务器: 10.147.11.71       ---> DNS服务器地址
                            [01]: 10.122.166.103           ---> 本机地址


<a id="orgeb67873"></a>

### `net time /domain` 判断

-   如果存在域会从域控返回时间， 并在第一行返回域控及域名
-   如果当前服务器在域内但是当前用户非域用户，则会返回System error 5就表示权限不够
-   返回找不到域Workgroup的域控制器表示当前网络环境为工作组

    net time /domain

![img](https://raw.githubusercontent.com/crkmythical/PicGo/main/images/20210609155122windows.png)


<a id="org2070906"></a>

### `net config workstation` 判断

其中工作域显示域名，同样若为WORKGROUP则非域环境，登录域表明当前用户是域用户登录还是本地用户登录

    net config workstation
    
    计算机名                     \\ETHANHUNTER78BC
    计算机全名                   ETHANHUNTER78BC
    用户名                       ethan
    
    工作站正运行于               
        NetBT_Tcpip_{0329A0F2-ADD9-4358-93A2-CC710202AAEF} (001C42EB757D)
    
    软件版本                     Windows 10 Pro for Workstations
    
    工作站域                     XXZX //WORKGROUP为不在域内
    工作站域DNS名称               xxzx.example.local
    登录域                       XXZX     // 表面当前用户是域用户


<a id="org06320c0"></a>

# 探测存活主机


<a id="orgcbed0df"></a>

## 利用ICMP协议探测

    for /L %I in (1,1,254) do @ping -w 1 -n 1 10.122.166.%I | findstr "TTL="

